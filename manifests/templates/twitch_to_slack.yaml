apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: workflow-twitch-to-slack
  # temp
  namespace: argo-workflows
spec:
  entrypoint: tts-temp
  # temp
  serviceAccountName: argo-workflow
#  arguments:
#    parameters:
#      - name: message
#        value: one
#        enum:
#          -   one
#          -   two
#          -   three
  templates:
    - name: tts-temp
#      inputs:
#        parameters:
#          - name: message
#            value: '{{workflow.parameters.message}}'
      container:
        name: main
        image: ghcr.io/whale-net/workflows:dev
        args:
          - tts
          - temp-entrypoint
          - '{{workflow.scheduledTime}}'
        env:
          - name: TWITCH_API_APP_ID
            valueFrom:
              secretKeyRef:
                name: twitch-secrets
                key: api-app-id
          - name: TWITCH_API_APP_SECRET
            valueFrom:
              secretKeyRef:
                name: twitch-secrets
                key: api-app-secret
          - name: SLACK_WHALEBOT_OAUTH_TOKEN
            valueFrom:
              secretKeyRef:
                name: slack-secrets
                key: whalebot-oauth-token
          # TODO long term should be sourced from elsewhere
          - name: SLACK_TWITCH_ALERT_CHANNEL_ID
            valueFrom:
              secretKeyRef:
                name: slack-secrets
                key: twitch-alert-channel-id
